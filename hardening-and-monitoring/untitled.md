---
description: >-
  Since this is not a complete Linux tutorial I'm not going to explain every
  little detail of Linux OS architecture and administration, just some tips for
  hardening your OS.
---

# ðŸ”§ Linux Hardening Checklist

Since there are so many checklists, standards and guides for operating system hardening out there, i tried to make this as short as possible so i wont need to read through 200 pages of some manual every time i want to configure a system.

#### This checklist is a combination of my own experience plus the methods and techniques included in guides like CIS benchmarks and some other resources on the web. the target distro in most of these items is Ubuntu/Debian based distros but most of them are applicable on RedHat/CentOS as well. this is by no means an all-in-one solution and i highly appreciate any comments, adages and rants you might have :)



## File System Security

| **tasks/configurations**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | **methods/commands**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **separate partitions while installing the system (prevention from local attacks, starvation and privilege escalation)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | <p>/boot</p><p> /home</p><p> /usr</p><p> /var </p><p>/tmp </p><p>/var/tmp</p><p> /var/log </p><p>/var/log/audit</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **nodev option set on /tmp**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <p>Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /tmp partition.</p><p> See the fstab(5) manual page for more information. </p><p></p><p>Run the following command to remount /tmp :</p><p></p><p> # mount -o remount,nodev /tmp</p>                                                                                                                                                                                                                                                                                                                                                                               |
| **nosuid option set on /tmp partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <p>If a /tmp partition exists run the following command and verify that the nosuid option is set on /tmp: </p><p></p><p># mount | grep /tmp </p><p></p><p>Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /tmp partition Run the following command to remount /tmp : </p><p></p><p>#mount -o remount,nosuid /tmp</p>                                                                                                                                                                                                                                                                                                |
| **nodev option set on /var/tmp partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <p>mount | grep /var/tmp Edit the /etc/fstab file and add nodev to the fourth field </p><p></p><p>#mount -o remount,nodev /var/tmp</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **nosuid option set on /var/tmp partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <p>mount | grep /var/tmp Edit the /etc/fstab file and add nosuid to the fourth field:</p><p></p><p># mount -o remount,nosuid /var/tmp</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **noexec option set on /var/tmp partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <p>mount | grep /var/tmp Edit the /etc/fstab file and add noexec to the fourth field:</p><p></p><p># mount -o remount,noexec /var/tmp</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **nodev option set on /home partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | <p>mount | grep /home Edit the /etc/fstab file and add nodev to the fourth field:</p><p></p><p># mount -o remount,nodev /home</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **nodev option set on /dev/shm partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | <p>mount | grep /dev/shm Edit the /etc/fstab file and add nodev to the fourth field:</p><p></p><p># mount -o remount,nodev /dev/shm</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **nosuid option set on /dev/shm partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <p>mount | grep /dev/shm Edit the /etc/fstab file and add nosuid to the fourth field:</p><p></p><p># mount -o remount,nosuid /dev/shm</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **noexec option set on /dev/shm partition**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | <p>mount | grep /dev/shm </p><p></p><p>Edit the /etc/fstab file and add noexec to the fourth field:</p><p></p><p>#mount -o remount,noexec /dev/shm</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **nodev option set on removable media partitions**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Run the following command and verify that the nodev option is set on all removable media partitions  mount Edit the /etc/fstab file and add nodev to the fourth field                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **nosuid option set on removable media partitions**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Run the following command and verify that the nosuid option is set on all removable media partitions mount Edit the /etc/fstab file and add nosuid to the fourth field                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **noexec option set on removable media partitions**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Run the following command and verify that the noexec option is set on all removable media partitions mount Edit the /etc/fstab file and add noexec to the fourth field                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **sticky bit is set on all world-writable directories (prevents users from deleting or renaming files in that directory that are not owned by them)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | <p>Run the following command to verify no world writable directories exist without the sticky bit set:</p><p></p><p># df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d \( -perm -0002 -a ! -perm -1000 \) 2>/dev/null </p><p></p><p>No output should be returned Run the following command to set the sticky bit on all world writable directories:</p><p></p><p> df --local -P | awk {'if (NR!=1) print $6'} | xargs -I '{}' find '{}' -xdev -type d -perm -0002 2>/dev/null | xargs chmod a+t</p>                                                                                                                     |
| **Disable Auto mounting (prevent physical access attacks, not for workstation users)**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <p>Run the following command to verify autofs is not enabled: </p><p></p><p># systemctl is-enabled autofs </p><p></p><p>Verify result is not "enabled". to disable autofs : </p><p></p><p>systemctl disable autofs</p>                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **mount options**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | <p>nodev : no device access nosuid : no setuid </p><p></p><p>programs noexec : prevent running exec </p><p></p><p>--remount, noexec : mount again with no exec</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><strong>Filesystem Integrity Checking while initializing the data base aide will take an snapshot of all system libraries and binaries for future compare to see if anything changed or not copy the new created db in /var/lib/aide aide.db.new.gz to aide.db.gz do a check for all files for mismatches: </strong></p><p><strong></strong></p><p><strong># aide --check</strong></p><p><strong></strong></p><p><strong> if there was a change we will see a warning Updating the aide DB after checking the aide db: </strong></p><p><strong></strong></p><p><strong>aide -c aide.conf --update </strong></p><p><strong></strong></p><p><strong>This will reset the database to the current status of the /etc/ sub-directory.</strong></p> | <p>Ensure AIDE is installed: </p><p></p><p># dpkg -s aide install aide: # apt-get install aide aide-common initialize aide:</p><p></p><p> # aideinit </p><p></p><p>conf file: /etc/aide.conf</p><p> log file: /etc/log/aide db: </p><p>/etc/lib/aide </p><p></p><p>determine if there is a cron job scheduled to run the aide check: # </p><p></p><p>crontab -u root -l | grep aide </p><p># grep -r aide /etc/cron.* /etc/crontab </p><p></p><p>Run the following command: </p><p></p><p># crontab -u root -e </p><p></p><p>Add the following line to the crontab:</p><p></p><p> 0 5 * * * /usr/bin/aide.wrapper --config /etc/aide/aide.conf --check</p> |



## OS Security

| tasks/configurations                                                                                                                                                                                                                                                                                                            | methods/commands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **verify package repositories**                                                                                                                                                                                                                                                                                                 | apt-cache policy                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Ensure GPG keys are configured**                                                                                                                                                                                                                                                                                              | apt-key list                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **text console messages / warning banners**                                                                                                                                                                                                                                                                                     | /etc/issue : before login /etc/motd : after login                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **disable Ctrl+Alt+Del**                                                                                                                                                                                                                                                                                                        |  systemctl mask ctrl+alt+del.target                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **update strategy**                                                                                                                                                                                                                                                                                                             | RHEL : updateinfo yum install yum-plugin-security Debian : apt-get -s dist-upgrade \| grep "^Inst" \| awk -F " " '{ print $2 }' \| xargs apt-get install unattended-upgrades                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **auto update**                                                                                                                                                                                                                                                                                                                 | setup auto-update for RHEL & Debian                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **validate packages**                                                                                                                                                                                                                                                                                                           | <p>RHEL : </p><p>rpm -Va </p><p></p><p> Debian : </p><p>debsums -l >>> generate a list </p><p>debsums -c >>> check all</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **bootloader security**                                                                                                                                                                                                                                                                                                         | <p>check if grub is password protected: </p><p></p><p>#grep "^set superusers" /boot/grub/grub.cfg grep "^password" /boot/grub/grub.cfg </p><p></p><p>Create an encrypted password with grub-mkpasswd-pbkdf2 :</p><p></p><p> # grub-mkpasswd-pbkdf2 Add the following into /etc/grub.d/00_header or a custom /etc/grub.d configuration file: </p><p></p><p>``` cat &#x3C;&#x3C;EOF set superusers="&#x3C;username>" password_pbkdf2 &#x3C;username> &#x3C;encrypted-password> EOF ``` </p><p></p><p>Run the following command to update the grub2 configuration: </p><p></p><p># update-grub </p><p></p><p>Run the following command and verify Uid and Gid are both 0/root and Access does not grant permissions to group or other : </p><p></p><p># stat /boot/grub/grub.cfg </p><p></p><p>Run the following commands to set permissions on your grub configuration:</p><p></p><p> # chown root:root /boot/grub/grub.cfg </p><p># chmod og-rwx /boot/grub/grub.cfg</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **core dumps restrictions (prevents users from overriding the soft variable and confidential information leak)**                                                                                                                                                                                                                | <p>Run the following commands and verify output matches: </p><p></p><p># grep "hard core" /etc/security/limits.conf /etc/security/limits.d/* * hard core 0 </p><p></p><p># sysctl fs.suid_dumpable fs.suid_dumpable = 0</p><p></p><p> # grep "fs\.suid_dumpable" /etc/sysctl.conf /etc/sysctl.d/* fs.suid_dumpable = 0</p><p></p><p> Add the following line to /etc/security/limits.conf or a /etc/security/limits.d/* file:</p><p></p><p> * hard core 0 </p><p></p><p>Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file:</p><p></p><p> fs.suid_dumpable = 0 </p><p></p><p>Run the following command to set the active kernel parameter: </p><p></p><p># sysctl -w fs.suid_dumpable=0</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **enable XD/NX support (no execute / execute disable, Enabling any feature that can protect against buffer overflow attacks enhances the security of the system.)**                                                                                                                                                             | <p>Run the following command and verify your kernel has identified and activated NX/XD protection: </p><p></p><p># dmesg | grep NX NX (Execute Disable) protection: active</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **enable address space layout randomization (ASLR)**                                                                                                                                                                                                                                                                            | <p>Run the following command and verify output matches </p><p></p><p># sysctl kernel.randomize_va_space kernel.randomize_va_space = 2 </p><p></p><p># grep "kernel\.randomize_va_space" /etc/sysctl.conf /etc/sysctl.d/* kernel.randomize_va_space = 2 </p><p></p><p>Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: </p><p></p><p>kernel.randomize_va_space = 2</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **disable prelink (prelinking feature can interfere with the operation of AIDE, because it changes binaries.)**                                                                                                                                                                                                                 | <p>verify prelink is not installed: </p><p></p><p># dpkg -s prelink </p><p></p><p>restore binaries to normal: </p><p></p><p># prelink -ua uninstall prelink : </p><p></p><p># apt-get remove prelink</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **enable SELinux in bootloader configurations**                                                                                                                                                                                                                                                                                 | <p>verify that no linux line has the selinux=0 or enforcing=0 parameters set: </p><p></p><p># grep "^\s*linux" /boot/grub/grub.cfg </p><p></p><p>Edit /etc/default/grub and remove all instances of selinux=0 and enforcing=0 from all CMDLINE_LINUX parameters: </p><p></p><p>GRUB_CMDLINE_LINUX_DEFAULT="quiet" GRUB_CMDLINE_LINUX="" </p><p></p><p>update the grub2 configuration: </p><p></p><p># update-grub</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **set SELinux enforsing state**                                                                                                                                                                                                                                                                                                 | <p>ensure output matches:</p><p></p><p> # grep SELINUX=enforcing /etc/selinux/config</p><p> SELINUX=enforcing </p><p></p><p># sestatus </p><p>SELinux status: enabled </p><p>Current mode: enforcing </p><p>Mode from config file: enforcing</p><p></p><p> Edit the /etc/selinux/config file to set the SELINUX parameter: </p><p></p><p>SELINUX=enforcing</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Configure AppArmor**                                                                                                                                                                                                                                                                                                          | http://wiki.apparmor.net/index.php/Documentation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **enable apparmor in bootloader**                                                                                                                                                                                                                                                                                               | <p>verify that no linux line the apparmor=0 parameter set:</p><p></p><p> # grep "^\s*linux" /boot/grub/grub.cfg</p><p></p><p> Edit /etc/default/grub and remove all instances of apparmor=0 from all CMDLINE_LINUX parameters: </p><p></p><p>GRUB_CMDLINE_LINUX_DEFAULT="quiet" GRUB_CMDLINE_LINUX=""</p><p></p><p> update the grub2 configuration: </p><p></p><p># update-grub</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **set all AppArmor profiles to enforcing**                                                                                                                                                                                                                                                                                      | <p>Run the following command and verify that profiles are loaded, no profiles are in complain mode, and no processes are unconfined: </p><p></p><p># apparmor_status</p><p></p><p> set all profiles to enforce mode: </p><p></p><p># aa-enforce /etc/apparmor.d/*</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **scan kernel parameters with Lynis**                                                                                                                                                                                                                                                                                           | <p># apt install lynis </p><p># lynis audit system </p><p></p><p>Use grep to send all of the DIFFERENT lines to a new file. Name it 60- secure_values.conf:</p><p></p><p> # grep "DIFFERENT" secure_values,conf > 60-secure_values.conf </p><p></p><p>Edit the 60-secure_values.conf file to convert it into the sysctl configuration format. </p><p></p><p>Set each parameter to the exp value that's currently within the pairs of parentheses. The finished product should look something like this:</p><p></p><p> ``` kernel.dmesg_restrict = 1 kernel.kptr_restrict = 2 kernel.sysrq = 0 kernel.yama.ptrace_scope = 1 2 3 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.all.log_martians = 1 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.log_martians = 1 net.ipv6.conf.all.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0 ``` </p><p></p><p></p><p>Copy the file to the /etc/sysctl.d directory: </p><p></p><p># sudo cp 60-secure_values.conf /etc/sysctl.d/ </p><p></p><p>Reboot the machine to read in the values from the new file:</p><p></p><p> # sudo shutdown -r now</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **process isolation (prevent users from seeing each others processes)**                                                                                                                                                                                                                                                         | <p>mount the /proc filesystem with the hidepid option. </p><p>You can do this by adding the following line to the end of the /etc/fstab file, like so:</p><p></p><p> # nano /etc/fstab add: </p><p></p><p>``` proc /proc proc hidepid=2 0 0 ``` </p><p></p><p>Then, remount /proc , like so: </p><p></p><p>#mount -o remount proc</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **resource limits on processes**                                                                                                                                                                                                                                                                                                | <p>could do that by hand-editing the systemd service file for each service that we want to limit, but it's easier to just run a systemctl command, like so for example for apache service: </p><p></p><p># sudo systemctl set-property apache2.service MemoryAccounting=1 CPUAccounting=1 BlockIOAccounting=1 </p><p></p><p>now there is a directory created for apache service in /etc/systemd/system.control named apache2.service.d which contains files that turn our accounting functions on. </p><p>inside each file we see 2 lines modify the original apache2.service file in order to turn on accounting: </p><p></p><p>``` CPUAccounting=yes ``` </p><p></p><p>to set resource limits for each account type: </p><p></p><p># systemctl set-property apache2.service CPUQouta=40% MemoryLimit=500M</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **resource limits on user accounts**                                                                                                                                                                                                                                                                                            | <p># systemctl set-property user-&#x3C;UID>.slice MemoryAccounting=1 CPUAccounting=1 BlockIOAccounting=1 </p><p></p><p>#systemctl set-property user-&#x3C;UID>.slice CPUQouta=20% MemoryLimit=500M</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **sandbox untrusted applications using firejail (uses namespaces, SECCOMP, and kernel capabilities to run untrusted applications in their own individual sandboxes)**                                                                                                                                                           | <p>installation: </p><p></p><p># apt install firejail </p><p></p><p>usage: </p><p></p><p># firejail &#x3C;application></p><p></p><p> # firejail firefox </p><p></p><p>run a sandbox with dropped capabilities: </p><p></p><p># firejail --caps.drop=all chromium-browser</p><p></p><p> to create a symbolic link for each program:</p><p></p><p> # firecfg</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **sandboxing using Snappy**                                                                                                                                                                                                                                                                                                     | <p>install: # apt install snapd search for apps online to run: </p><p></p><p># snap search &#x3C;app> </p><p></p><p>install the app:</p><p></p><p> # snap install &#x3C;app> </p><p></p><p>create an account at ubuntu.com and login in snap with your credentials: </p><p></p><p># snap login </p><p></p><p>start the app in sandbox:</p><p></p><p> # snap start</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| <p>disable unneeded debugging/testing services: </p><p><strong></strong></p><p><strong>daytime </strong></p><p><strong>chargen </strong></p><p><strong>discard </strong></p><p><strong>echo </strong></p><p><strong>time </strong></p><p><strong>rsh </strong></p><p><strong>telnet </strong></p><p><strong>xinetd</strong></p> | <p>Comment out or remove any lines starting with chargen from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all chargen services in /etc/xinetd.conf and /etc/xinetd.d/* .</p><p></p><p> Comment out or remove any lines starting with daytime from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all daytime services in /etc/xinetd.conf and /etc/xinetd.d/* . </p><p></p><p>Comment out or remove any lines starting with discard from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all discard services in /etc/xinetd.conf and /etc xinetd.d/* . </p><p></p><p>Comment out or remove any lines starting with echo from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all echo services in /etc/xinetd.conf and /etc xinetd.d/* .</p><p></p><p> Comment out or remove any lines starting with time from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all time services in /etc/xinetd.conf and /etc/xinetd.d/* . </p><p></p><p>Verify the rsh services are not enabled. Run the following commands and verify results are as indicated: </p><p><strong></strong></p><p><strong>#</strong>grep -R "^shell" /etc/inetd.* grep -R "^login" /etc/inetd.* </p><p><strong>#</strong>grep -R "^exec" /etc/inetd.* </p><p></p><p>No results should be returned check /etc/xinetd.conf and /etc/xinetd.d/* and verify all rsh , rlogin , and rexec services have disable = yes set.</p><p></p><p> Comment out or remove any lines starting with shell , login , or exec from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all rsh , rlogin , and rexec services in /etc/xinetd.conf and /etc/xinetd.d/* .</p><p></p><p> Verify the telnet service is not enabled. Run the following command and verify results are as indicated: </p><p></p><p># grep -R "^telnet" /etc/inetd.*</p><p></p><p> check /etc/xinetd.conf and /etc/xinetd.d/* and verify all telnet services have disable = yes set.</p><p></p><p> Comment out or remove any lines starting with telnet from /etc/inetd.conf and /etc/inetd.d/* . Set disable = yes on all telnet services in /etc/xinetd.conf and /etc xinetd.d/* . </p><p></p><p>Run the following command to verify xinetd is not enabled: </p><p></p><p># systemctl is-enabled xinetd </p><p></p><p>Run the following command to disable xinetd : </p><p></p><p># systemctl disable xinetd</p> |
| **enable time synchronization and configure ntp service**                                                                                                                                                                                                                                                                       | <p>On physical systems or virtual systems where host based time synchronization is not available run the following commands and verify either NTP or chrony is installed: </p><p></p><p># dpkg -s ntp # dpkg -s chrony </p><p></p><p>On physical systems or virtual systems where host based time synchronization is not available install NTP or chrony using one of the following commands: </p><p></p><p># apt-get install ntp # apt-get install chrony</p><p></p><p> Run the following command and verify output matches: </p><p></p><p># grep "^restrict" /etc/ntp.conf restrict -4 default kod nomodify notrap nopeer noquery restrict -6 default kod nomodify notrap nopeer noquery </p><p></p><p>Run the following command and verify remote server is configured properly: </p><p></p><p># egrep "^(server|pool)" /etc/ntp.conf server &#x3C;remote-server> Multiple servers may be configured. </p><p></p><p>Verify that ntp is configured to run as the ntp user by running the following command: </p><p></p><p># grep "RUNASUSER=ntp" /etc/init.d/ntp RUNASUSER=ntp </p><p></p><p>Add or edit restrict lines in /etc/ntp.conf to match the following: </p><p></p><p>```</p><p>restrict -4 default kod nomodify notrap nopeer noquery restrict -6 default kod nomodify notrap nopeer noquery </p><p>```</p><p></p><p>Add or edit server or pool lines to /etc/ntp.conf as appropriate: </p><p></p><p>server &#x3C;remote-server> </p><p></p><p>Configure ntp to run as the ntp user by adding or editing the /etc/init.d ntp file: </p><p></p><p>RUNASUSER=ntp</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

## Account Security

| tasks/configurations                                                                                                                                               | methods/commands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| System / Application Accounts                                                                                                                                      | <p>Use one account per service.</p><p></p><p>Donâ€™t activate the account. Donâ€™t allow direct logins from the account.</p><p>web service (httpd), web service account (apache) sshd_config:</p><p></p><p> ```</p><p>DenyUsers account1 accountN</p><p>```</p><p></p><p>Use sudo for all access. </p><p></p><p># sudo -u apache apachectl configtest</p><p></p><p>User Accounts: One account per person.</p><p></p><p>Deleting Accounts: Determine the UID, Delete their account and home directory </p><p></p><p>#id ACCOUNT userdel -r</p><p></p><p>Find other files that belong to them on the system:</p><p>#find / -user UID find / -nouser</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **determine if a password is set for the root user**                                                                                                               | <p>#grep ^root:[*!]: /etc/shadow</p><p></p><p>No results should be returned.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **remember to specify all user options while adding a new user ( shell path, group, sudo permissions and home directory path )**                                   | e.g: sudo useradd -G wheel -m -d /home/frank -s /bin/bash                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **enforce strong password criteria with PAM pwquiality module ( replacement for old cracklib module, preinstalled in RHEL/CentOS 7/8 )**                           | <p>cd into the /etc/pam.d directory, you can do a grep operation to see that the PAM configuration files are already set up. retry=3 means that a user will only have three tries to get the password right when logging in to the system:</p><p></p><p>#grep 'pwquality' *</p><p></p><p>edit this section in the /etc/security/pwquality.conf file:</p><pre><code># Minimum acceptable size for the new password (plus one if
# credits are not disabled which is the default). (See pam_cracklib
manual.)
# Cannot be set to lower value than 6.
# minlen = 8
....</code></pre><p>minlen: minimum length of password lcredit: set to 0 if you dont want lowercase letters to count toward your credit</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <p><strong>prevent password spraying attacks with PAM (for local logins and priviledge escalation)</strong></p><p><strong>using pam_tally2 PAM module</strong></p> | <p>module is preinstalled on CentOS\RHEL\ubuntu</p><p></p><p>edit the config file in /etc/pam.d/login:</p><p></p><p>there is and example at the bottom of the pam_tally2</p><p></p><p>In the second line of the example, we see that pam_tally2 is set with the following:</p><p></p><p>deny=4 : This means that the user account under attack will get locked out after only four failed login attempts.</p><p></p><p>even_deny_root: This means that even the root user account will get locked if it's under attack.</p><p></p><p>unlock_time=1200: The account will get automatically unlocked after 1,200 seconds, or 20 minutes</p><p></p><p>you need to log out of your account to check the configurations because the pam_tally2 modules doesnt work with su command. it only works with new console (tty) logins.</p><p>Once you've configured the login file and have had a failed login, you'll see a new file created in the /var/log directory.</p><p></p><p> You'll view information from that file with the pam_tally2 utility. You can also use pam_tally2 to manually unlock a locked account if you don't want to wait for the timeout period:</p><p></p><p>#sudo pam_tally2 : show latest failed login attempt </p><p>#sudo pam_tally2 --user=user1 --reset : reset timeout</p> |
| **check account aging for all user accounts (be careful with service accounts )**                                                                                  | <p></p><p>see account expiration info: #chage -l user1</p><p>options for account expiration date:</p><p></p><p>-I, --inactive INACTIVE set password inactive after expiration</p><p></p><p> -m, --mindays MIN_DAYS set minimum number of days before password </p><p></p><p>-M, --maxdays MAX_DAYS set maximum number of days before password</p><p></p><p> -W, --warndays WARN_DAYS set expiration warning days to WARN_DAYS </p><p></p><p>-d, --lastday LAST_DAY set date of last password change to LAST_DAY</p><p></p><p>set aging options while creating new user: </p><p></p><p>#useradd -e 2020-12-31 charlie</p><p></p><p>or set the number of days:</p><p></p><p> #usermod -f 5 charlie</p><p></p><p>set default account aging options ( for CentOS/RHEL, doesnt work for ubuntu ) :</p><p>edit /etc/default/useradd:</p><pre><code>#useradd defaults file
GROUP=100
HOME=/home
INACTIVE=-1
EXPIRE=
SHELL=/bin/bash
SKEL=/etc/skel
CREATE_MAIL_SPOOL=yes</code></pre>                                                                                                                                                                                                                                                                                                                      |
| **check login/logout monitoring**                                                                                                                                  | <p>last</p><p> lastb </p><p>lastlog â†’ last time a user has logged in</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **regularly check authentication log files**                                                                                                                       | <p>/var/log/messages</p><p> /var/log/syslog </p><p>/var/log/secure </p><p>/var/log/auth.log</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **edit /etc/sudoers files**                                                                                                                                        | <p>sudoers file format: </p><p></p><p>user host=(run_as_user : run_as_group) command</p><p></p><p><strong>root</strong> ALL=(ALL:ALL) ALL </p><p></p><p>The first field indicates the username that the rule will apply to (root).</p><p></p><p>demo <strong>ALL</strong>=(ALL:ALL) ALL</p><p></p><p> The first â€œALLâ€ indicates that this rule applies to all hosts.</p><p></p><p>demo ALL=(<strong>ALL</strong>:ALL) ALL</p><p></p><p> The second â€œALLâ€ indicates that the root user can run commands as all users.</p><p></p><p>demo ALL=(ALL:<strong>ALL</strong>) ALL </p><p></p><p>The third â€œALLâ€ indicates that the root user can run commands as all groups.</p><p></p><p>demo ALL=(ALL:ALL) <strong>ALL</strong> </p><p></p><p>The last â€œALLâ€ indicates these rules apply to all commands.</p><p></p><p></p><p>This means that our root user can run any command using sudo, as long as they provide their password</p>                                                                                                                                                                                                                                                                                                                                                                    |

\


## Network

| tasks/configurations           | methods/commands                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Drop source routed packets** | <p>Run the following commands and verify output matches: </p><p></p><p>#sysctl net.ipv4.conf.all.accept_source_route net.ipv4.conf.all.accept_source_route = 0 </p><p></p><p>#sysctl net.ipv4.conf.default.accept_source_route net.ipv4.conf.default.accept_source_route = 0 </p><p></p><p>#grep "net.ipv4.conf.all.accept_source_route" /etc/sysctl.conf /etc/sysctl.d/* net.ipv4.conf.all.accept_source_route= 0 </p><p></p><p>#grep "net.ipv4.conf.default.accept_source_route" /etc/sysctl.conf /etc/sysctl.d/* net.ipv4.conf.default.accept_source_route= 0</p><p></p><p>Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: </p><p></p><p>net.ipv4.conf.all.accept_source_route = 0 net.ipv4.conf.default.accept_source_route = 0</p><p></p><p>Run the following commands to set the active kernel parameters: </p><p></p><p>#sysctl -w net.ipv4.conf.all.accept_source_route=0 </p><p></p><p>#sysctl -w net.ipv4.conf.default.accept_source_route=0 </p><p></p><p>#sysctl -w net.ipv4.route.flush=1</p> |
| **Drop ICMP redirections**     | <p>Run the following commands and verify output matches:</p><p></p><p> #sysctl net.ipv4.conf.all.accept_redirects net.ipv4.conf.all.accept_redirects = 0 </p><p></p><p>#sysctl net.ipv4.conf.default.accept_redirects net.ipv4.conf.default.accept_redirects = 0 </p><p></p><p>#grep "net.ipv4.conf.all.accept_redirects" /etc/sysctl.conf /etc/sysctl.d/* net.ipv4.conf.all.accept_redirects= 0 </p><p></p><p>#grep "net.ipv4.conf.default.accept_redirects" /etc/sysctl.conf /etc/sysctl.d/* net.ipv4.conf.default.accept_redirects= 0</p><p></p><p>Set the following parameters in /etc/sysctl.conf or a /etc/sysctl.d/* file: </p><p></p><p>net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.default.accept_redirects = 0</p><p></p><p></p><p>Run the following commands to set the active kernel parameters: </p><p></p><p>#sysctl -w net.ipv4.conf.all.accept_redirects=0 </p><p>#sysctl -w net.ipv4.conf.default.accept_redirects=0 </p><p>#sysctl -w net.ipv4.route.flush=1</p>                                            |
|                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |











 
